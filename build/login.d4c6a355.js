function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var t=globalThis,n={},o={},a=t.parcelRequire94c2;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},t.parcelRequire94c2=a);var r=a.register;r("kxgSl",function(t,n){e(t.exports,"logout",()=>g);var o=a("LMLC2");async function r(){let e=document.getElementById("username").value,t=document.getElementById("password").value;console.log(window.config.apiBaseUrl),await i({username:e,password:t})}async function i(e){try{let t=await fetch(`https://${window.config.apiBaseUrl}/api/Auth/Login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();n.userName&&localStorage.setItem("loginName",n.userName),n.jwtToken?(localStorage.setItem("jwtToken",n.jwtToken),window.location.href="/"):(console.log("No Token! Please check."),document.getElementById("errorMessage").textContent="Token Failed")}catch(e){console.error("Error:",e),document.getElementById("errorMessage").textContent="Login failed!"}}async function l(){let e=document.getElementById("username").value,t=document.getElementById("password").value,n=document.getElementById("CheckboxLarge").checked?["writer"]:["reader"];if(!e||!t){alert("Username and password cannot be empty.");return}var o={userName:e,password:t,roles:n};try{let e=await s();e&&(o.playerId=e),await c(o)}catch(e){console.error("Error getting playerId from OneSignal:",e)}}async function c(e){try{let t=await fetch(`https://${window.config.apiBaseUrl}/api/Auth/Register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let n=await t.text();console.log("Registration Successful:",n),alert(n),await (0,o.initializeOneSignal)(e.userName),window.location.href="/login"}else{let e=await t.text();alert("Registration failed. Please check your permissions."),console.error("Failed to register:",e)}}catch(e){alert("Load data failed, please check your connection to the backend."),console.error("Error:",e)}}async function s(){try{let e=await OneSignal.getUserId();return console.log("Player ID from OneSignal:",e),e}catch(e){return console.error("Error getting playerId from OneSignal:",e),null}}async function g(){localStorage.removeItem("jwtToken"),window.location.href="/login",localStorage.setItem("logoutMessage","Logout succeeded!")}document.addEventListener("DOMContentLoaded",()=>{let e=localStorage.getItem("logoutMessage");e&&(alert(e),localStorage.removeItem("logoutMessage"));let t=document.getElementById("CheckboxLarge"),n=document.getElementById("checkboxLabel");function o(){let e=t.checked?"Writer":"Reader";n.textContent!==e&&(n.textContent=e)}null!=t&&(t.addEventListener("change",o),o()),window.OneSignal||console.error("OneSignal chưa được tải. Vui lòng kiểm tra.")});let d={Register:c,login:i,callLogin:r,callRegister:l,initializeOneSignal:o.initializeOneSignal,getOneSignalPlayerId:s};Object.keys(d).forEach(e=>{window[e]=d[e]})}),r("LMLC2",function(t,n){e(t.exports,"initializeOneSignal",()=>o);async function o(e){if(window.OneSignal)try{await OneSignal.init({appId:"523487ee-5286-415a-8973-77cbd85d83bb",serviceWorkerPath:"/OneSignalSDKWorker.js",promptOptions:{slidedown:{enabled:!0}}}),console.log("OneSignal initialized successfully."),await OneSignal.setExternalUserId(e),console.log("Assigned external user ID:",e),await OneSignal.showSlidedownPrompt(),console.log("Displayed subscription prompt."),OneSignal.on("subscriptionChange",function(e){e&&OneSignal.getUserId().then(function(e){console.log("Player ID:",e)})})}catch(e){console.error("Failed to initialize OneSignal:",e)}else console.error("OneSignal SDK chưa được tải.")}}),a("kxgSl");
//# sourceMappingURL=login.d4c6a355.js.map
